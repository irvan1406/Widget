<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Masjid Proyektor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/id.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.1/dist/Adhan.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@900&family=JetBrains+Mono:wght@800&display=swap');
        body { background: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; margin: 0; }
        .marquee { white-space: nowrap; animation: move var(--speed, 35s) linear infinite; font-size: 3rem; color: #ffcc00; font-weight: 900; display: inline-block; }
        @keyframes move { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }
        #bg-img, #v-layer { position: fixed; inset: 0; pointer-events: none; transition: opacity 1s; }
        .prayer-card { background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 2rem; border: 1px solid rgba(255,255,255,0.1); }
    </style>
</head>
<body>
    <div id="interaction-overlay" onclick="activateFullscreen(this)" class="fixed inset-0 bg-black z-[999] flex flex-col items-center justify-center cursor-pointer">
        <h1 class="text-3xl font-black animate-pulse uppercase italic">Klik Untuk Memulai</h1>
        <p class="text-sm opacity-40 mt-2 tracking-widest">MODE PROYEKTOR</p>
    </div>

    <div id="bg-img"></div>
    <div id="v-layer"></div>

    <div class="relative z-10 h-screen flex flex-col justify-between p-12 text-center">
        <div>
            <div id="date" class="text-3xl font-bold opacity-60 uppercase mb-4 tracking-widest"></div>
            <div class="bg-green-600/20 border border-green-500/40 px-8 py-3 rounded-full inline-flex items-center gap-4 text-2xl font-black">
                <span id="label-next" class="text-green-400">MENUNGGU...</span> 
                <span id="countdown" class="font-mono text-white">00:00:00</span>
            </div>
        </div>

        <div id="clock-container">
            <div id="clock" class="leading-none font-black tracking-tighter" style="font-size: 20vw;">00:00</div>
            <div id="seconds" class="text-6xl font-bold opacity-20 mt-4">00</div>
        </div>

        <div class="grid grid-cols-5 gap-6 mb-20 max-w-7xl mx-auto w-full">
            <div class="prayer-card"><div class="opacity-50 font-bold mb-2 uppercase">Subuh</div><div id="t-fajr" class="text-5xl font-black">--:--</div></div>
            <div class="prayer-card"><div class="opacity-50 font-bold mb-2 uppercase">Dzuhur</div><div id="t-dhuhr" class="text-5xl font-black">--:--</div></div>
            <div class="prayer-card"><div class="opacity-50 font-bold mb-2 uppercase">Ashar</div><div id="t-asr" class="text-5xl font-black">--:--</div></div>
            <div class="prayer-card"><div class="opacity-50 font-bold mb-2 uppercase">Maghrib</div><div id="t-maghrib" class="text-5xl font-black">--:--</div></div>
            <div class="prayer-card"><div class="opacity-50 font-bold mb-2 uppercase">Isya</div><div id="t-isha" class="text-5xl font-black">--:--</div></div>
        </div>
    </div>

    <div class="fixed bottom-0 w-full bg-black/80 backdrop-blur-md py-6 border-t border-white/10 overflow-hidden">
        <div id="m-text" class="marquee"></div>
    </div>

    <div id="alarm" class="fixed inset-0 bg-white text-black z-[1000] hidden flex flex-col items-center justify-center">
        <h1 class="text-[25vw] font-black italic tracking-tighter animate-bounce">ADZAN</h1>
        <p class="text-5xl font-bold uppercase tracking-[0.5em]">Waktunya Sholat</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse('{"apiKey": "AIzaSyDiM9qD23njTQ6G8m8qzkUsNWRuQPd2SeY", "authDomain": "ledd-f6b0f.firebaseapp.com", "projectId": "ledd-f6b0f", "storageBucket": "ledd-f6b0f.firebasestorage.app", "messagingSenderId": "341802454320", "appId": "1:341802454320:web:e0d13b16d14bc1ff5d8cf5"}');
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'masjid-display-global';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let conf = { lat: -8.2192, lng: 114.3691, runningTextSpeed: 35, fontSize: 20, fontFamily: 'Inter', showSeconds: true, bgOpacity: 0.3, videoOpacity: 0.3 };

        window.activateFullscreen = (el) => {
            if (document.documentElement.requestFullscreen) document.documentElement.requestFullscreen();
            el.remove();
        };

        const initAuth = async () => {
            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(auth, __initial_auth_token);
            } else {
                await signInAnonymously(auth);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings'), (snap) => {
                    if (snap.exists()) {
                        conf = { ...conf, ...snap.data() };
                        updateVisuals();
                    }
                }, (err) => console.error("Firestore Error:", err));
            }
        });

        initAuth();

        function updateVisuals() {
            const clockEl = document.getElementById('clock');
            clockEl.style.fontSize = `${conf.fontSize}vw`;
            clockEl.style.fontFamily = conf.fontFamily;
            
            document.getElementById('seconds').classList.toggle('hidden', !conf.showSeconds);
            document.getElementById('m-text').innerText = conf.runningText || "";
            document.getElementById('m-text').style.setProperty('--speed', `${conf.runningTextSpeed}s`);
            
            const bgImg = document.getElementById('bg-img');
            bgImg.style.backgroundImage = conf.bgUrl ? `url(${conf.bgUrl})` : 'none';
            bgImg.style.opacity = conf.bgOpacity;

            const vLayer = document.getElementById('v-layer');
            if (conf.ytId && vLayer.dataset.id !== conf.ytId) {
                vLayer.innerHTML = `<iframe class="w-full h-full scale-150" src="https://www.youtube.com/embed/${conf.ytId}?autoplay=1&mute=1&loop=1&playlist=${conf.ytId}&controls=0" frameborder="0"></iframe>`;
                vLayer.dataset.id = conf.ytId;
            } else if (!conf.ytId) {
                vLayer.innerHTML = "";
                delete vLayer.dataset.id;
            }
            vLayer.style.opacity = conf.videoOpacity;
            
            document.getElementById('alarm').classList.toggle('hidden', !conf.alarmActive);
        }

        function tick() {
            const now = moment().locale('id');
            document.getElementById('clock').innerText = now.format('HH:mm');
            document.getElementById('seconds').innerText = now.format('ss');
            document.getElementById('date').innerText = now.format('dddd, D MMMM YYYY');

            const coords = new adhan.Coordinates(parseFloat(conf.lat), parseFloat(conf.lng));
            const pTimes = new adhan.PrayerTimes(coords, new Date(), adhan.CalculationMethod.Kemenag());
            
            const list = [['fajr', pTimes.fajr, 'Subuh'], ['dhuhr', pTimes.dhuhr, 'Dzuhur'], ['asr', pTimes.asr, 'Ashar'], ['maghrib', pTimes.maghrib, 'Maghrib'], ['isha', pTimes.isha, 'Isya']];
            let next = null;
            
            list.forEach(([id, time, label]) => {
                const m = moment(time);
                document.getElementById(`t-${id}`).innerText = m.format('HH:mm');
                if (!next && m.isAfter(now)) next = { label, m };
            });

            const countdownEl = document.getElementById('countdown');
            const labelEl = document.getElementById('label-next');
            if (next) {
                const dur = moment.duration(next.m.diff(now));
                labelEl.innerText = `MENUJU ${next.label.toUpperCase()}`;
                countdownEl.innerText = `${String(dur.hours()).padStart(2,'0')}:${String(dur.minutes()).padStart(2,'0')}:${String(dur.seconds()).padStart(2,'0')}`;
            } else {
                labelEl.innerText = "MENUJU SUBUH";
                countdownEl.innerText = "--:--:--";
            }
        }
        setInterval(tick, 1000);
        tick();
    </script>
</body>
</html>

