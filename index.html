<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Display Proyektor Masjid</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/id.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/m-m-m/Adhan.js@master/dist/Adhan.min.js"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&family=JetBrains+Mono:wght@700&display=swap');

body {
  background:#000;
  color:#fff;
  font-family:'Plus Jakarta Sans',sans-serif;
  overflow:hidden;
}

#bg-img {
  position:fixed;
  inset:0;
  background-size:cover;
  background-position:center;
  z-index:-2;
}

#v-layer {
  position:fixed;
  inset:0;
  z-index:-1;
}

#overlay {
  position:fixed;
  inset:0;
  background:#000;
  z-index:-1;
}

.sholat-card {
  background:rgba(255,255,255,.08);
  backdrop-filter:blur(10px);
  border-radius:1.5rem;
  padding:1.5rem;
  border:1px solid rgba(255,255,255,.1);
  text-align:center;
}

#alarm {
  position:fixed;
  inset:0;
  z-index:100;
  background:black;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
}

#running {
  white-space:nowrap;
  display:inline-block;
}

@keyframes marquee {
  from { transform:translateX(100vw); }
  to { transform:translateX(-100%); }
}
</style>
</head>

<body class="flex flex-col items-center justify-center relative">

<div id="bg-img"></div>
<div id="v-layer"></div>
<div id="overlay"></div>

<div id="alarm">
  <h1 class="text-[15vw] font-black animate-pulse">ADZAN</h1>
  <p class="text-4xl font-bold tracking-widest mt-4">WAKTUNYA SHOLAT</p>
</div>

<div class="z-10 w-full max-w-6xl px-4 flex flex-col items-center text-center">
  <p id="date" class="text-4xl font-bold uppercase tracking-[0.3em] mb-4 text-blue-400"></p>

  <div class="bg-white/10 px-10 py-3 rounded-full mb-6 border border-white/20">
    <p id="label-next" class="text-xl font-black tracking-widest opacity-60">MENUJU ---</p>
    <p id="countdown" class="text-4xl font-black tabular-nums">00:00:00</p>
  </div>

  <div class="mb-10 flex items-baseline justify-center">
    <span id="clock" class="text-[18vw] font-black tabular-nums">00:00</span>
    <span id="seconds" class="text-[6vw] font-bold text-blue-500 ml-6 tabular-nums">00</span>
  </div>

  <div class="grid grid-cols-5 gap-6 w-full">
    <div class="sholat-card"><p class="opacity-60">Subuh</p><p id="t-fajr" class="text-5xl font-black">--:--</p></div>
    <div class="sholat-card"><p class="opacity-60">Dzuhur</p><p id="t-dhuhr" class="text-5xl font-black">--:--</p></div>
    <div class="sholat-card"><p class="opacity-60">Ashar</p><p id="t-asr" class="text-5xl font-black">--:--</p></div>
    <div class="sholat-card"><p class="opacity-60">Maghrib</p><p id="t-maghrib" class="text-5xl font-black">--:--</p></div>
    <div class="sholat-card"><p class="opacity-60">Isya</p><p id="t-isha" class="text-5xl font-black">--:--</p></div>
  </div>
</div>

<div class="fixed bottom-0 left-0 right-0 py-6 bg-black/60 overflow-hidden">
  <div id="running" class="text-3xl font-bold"></div>
</div>

<audio id="audio" loop></audio>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

const app = initializeApp({
  apiKey:"AIzaSyDiM9qD23njTQ6G8m8qzkUsNWRuQPd2SeY",
  authDomain:"ledd-f6b0f.firebaseapp.com",
  projectId:"ledd-f6b0f",
  storageBucket:"ledd-f6b0f.firebasestorage.app",
  messagingSenderId:"341802454320",
  appId:"1:341802454320:web:e0d13b16d14bc1ff5d8cf5"
});

const db = getFirestore(app);
let conf = {};

onSnapshot(
  doc(db,'artifacts','masjid-v1','public','data','config','main'),
  snap => {
    if(!snap.exists()) return;
    conf = snap.data();
    applyConfig();
  }
);

function applyConfig(){
  document.getElementById('clock').style.fontSize = (conf.fontSize||18)+'vw';
  document.getElementById('clock').style.fontFamily = conf.fontFamily||'Plus Jakarta Sans';
  document.getElementById('clock').style.color = conf.color||'#fff';

  document.getElementById('running').innerText = conf.runningText||'';
  document.getElementById('running').style.animation =
    `marquee ${110-(conf.runningTextSpeed||30)}s linear infinite`;
  document.getElementById('running').style.color = conf.color||'#fff';

  document.getElementById('bg-img').style.backgroundImage =
    conf.bgUrl ? `url(${conf.bgUrl})` : 'none';
  document.getElementById('bg-img').style.opacity = conf.opacity||0.5;

  const alarm = document.getElementById('alarm');
  const audio = document.getElementById('audio');

  if(conf.alarmActive){
    alarm.style.display='flex';
    if(conf.audioUrl && !conf.mute){
      audio.src = conf.audioUrl;
      audio.play().catch(()=>{});
    }
  } else {
    alarm.style.display='none';
    audio.pause();
  }
}

setInterval(()=>{
  const now = moment().locale('id');
  document.getElementById('clock').innerText = now.format('HH:mm');
  document.getElementById('seconds').innerText = now.format('ss');
  document.getElementById('date').innerText = now.format('dddd, D MMMM YYYY');

  if(!conf.lat || !conf.lng) return;
  const coords = new adhan.Coordinates(+conf.lat,+conf.lng);
  const times = new adhan.PrayerTimes(coords,new Date(),adhan.CalculationMethod.Singapore());

  const map = {
    fajr:times.fajr,dhuhr:times.dhuhr,asr:times.asr,
    maghrib:times.maghrib,isha:times.isha
  };

  Object.keys(map).forEach(k=>{
    document.getElementById('t-'+k).innerText = moment(map[k]).format('HH:mm');
  });
},1000);
</script>

</body>
                                                                          </html>
