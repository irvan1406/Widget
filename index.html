<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Masjid Proyektor - Modern</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/id.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.1/dist/Adhan.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&family=JetBrains+Mono:wght@800&display=swap');
        
        body { 
            margin: 0; 
            overflow: hidden; 
            background-color: #000; 
            color: white; 
            font-family: 'Inter', sans-serif;
        }

        #bg-image {
            position: fixed;
            inset: 0;
            background-size: cover;
            background-position: center;
            z-index: 0;
            pointer-events: none;
        }

        #video-layer {
            position: fixed;
            inset: 0;
            z-index: 1;
            pointer-events: none;
        }

        .main-container {
            position: relative;
            z-index: 10;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            background: radial-gradient(circle, transparent 10%, rgba(0,0,0,0.8) 100%);
            padding: 4rem 2rem;
        }

        .led-dot-matrix {
            background-image: radial-gradient(rgba(255,255,255,0.08) 1px, transparent 1px);
            background-size: 5px 5px;
        }

        .marquee-container {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: #000;
            padding: 1.2rem 0;
            border-top: 2px solid rgba(255,255,255,0.1);
            overflow: hidden;
            z-index: 50;
        }

        .marquee-text {
            display: inline-block;
            white-space: nowrap;
            animation: marquee var(--speed, 35s) linear infinite;
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffcc00; /* Warna khas running text LED */
        }

        @keyframes marquee {
            from { transform: translateX(100vw); }
            to { transform: translateX(-100%); }
        }

        .prayer-card {
            background: rgba(15, 15, 15, 0.85);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.15);
            border-radius: 1.5rem;
            padding: 1.5rem 1rem;
            text-align: center;
            transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .active-prayer {
            background: #ffffff !important;
            color: #000000 !important;
            transform: translateY(-15px) scale(1.05);
            box-shadow: 0 20px 50px rgba(255,255,255,0.3);
        }

        .active-prayer div { color: #000 !important; opacity: 1 !important; }

        #interaction-overlay {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .countdown-badge {
            background: rgba(34, 197, 94, 0.15);
            border: 1px solid rgba(34, 197, 94, 0.4);
            padding: 0.5rem 2rem;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            gap: 1rem;
        }
    </style>
</head>
<body>

    <!-- Overlay Start -->
    <div id="interaction-overlay" onclick="activateDisplay()">
        <div class="text-center p-12 border-2 border-white/20 rounded-[3rem] animate-pulse">
            <h1 class="text-4xl font-black tracking-tighter mb-4 uppercase italic">Bismillah - Klik Untuk Memulai</h1>
            <p class="opacity-40 text-sm tracking-[0.3em]">MODE PROYEKTOR FULLSCREEN</p>
        </div>
    </div>

    <div id="bg-image"></div>
    <div id="video-layer"></div>
    <div id="led-overlay" class="fixed inset-0 z-[5] pointer-events-none hidden led-dot-matrix"></div>

    <div class="main-container">
        <!-- HEADER: Date & Countdown Menuju Sholat -->
        <div class="flex flex-col items-center">
            <div id="display-date" class="text-3xl font-bold opacity-60 uppercase tracking-[0.25em] mb-6"></div>
            
            <div class="countdown-badge">
                <span id="label-menuju" class="text-2xl font-bold uppercase tracking-widest text-green-400">Menuju --</span>
                <span id="next-prayer-countdown" class="text-4xl font-black text-white font-mono">00:00:00</span>
            </div>
        </div>

        <!-- CENTER: Main Clock -->
        <div id="clock-wrapper" class="text-center">
            <div id="main-clock" class="font-black tracking-tighter" style="font-size: 20vw; line-height: 0.8;">00:00</div>
            <div id="seconds-wrap" class="text-6xl font-bold opacity-20 mt-6">00</div>
        </div>

        <!-- FOOTER: Prayer Grid -->
        <div class="grid grid-cols-5 gap-6 w-full max-w-7xl mx-auto mb-20">
            <div id="box-fajr" class="prayer-card">
                <div class="text-xl opacity-50 font-bold uppercase mb-1 tracking-wider">Subuh</div>
                <div id="time-fajr" class="text-6xl font-black">--:--</div>
            </div>
            <div id="box-dhuhr" class="prayer-card">
                <div class="text-xl opacity-50 font-bold uppercase mb-1 tracking-wider">Dzuhur</div>
                <div id="time-dhuhr" class="text-6xl font-black">--:--</div>
            </div>
            <div id="box-asr" class="prayer-card">
                <div class="text-xl opacity-50 font-bold uppercase mb-1 tracking-wider">Ashar</div>
                <div id="time-asr" class="text-6xl font-black">--:--</div>
            </div>
            <div id="box-maghrib" class="prayer-card">
                <div class="text-xl opacity-50 font-bold uppercase mb-1 tracking-wider">Maghrib</div>
                <div id="time-maghrib" class="text-6xl font-black">--:--</div>
            </div>
            <div id="box-isha" class="prayer-card">
                <div class="text-xl opacity-50 font-bold uppercase mb-1 tracking-wider">Isya</div>
                <div id="time-isha" class="text-6xl font-black">--:--</div>
            </div>
        </div>
    </div>

    <!-- Running Text -->
    <div id="marquee-bar" class="marquee-container hidden">
        <div id="marquee-text" class="marquee-text"></div>
    </div>

    <!-- Alarm View -->
    <div id="alarm-overlay" class="fixed inset-0 z-[10000] bg-white text-black hidden flex-col items-center justify-center text-center">
        <h1 class="text-[20vw] font-black leading-none italic tracking-tighter">ADZAN</h1>
        <p class="text-6xl font-bold uppercase tracking-[0.5em] mt-10 animate-bounce">Waktunya Sholat</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDiM9qD23njTQ6G8m8qzkUsNWRuQPd2SeY",
            authDomain: "ledd-f6b0f.firebaseapp.com",
            projectId: "ledd-f6b0f",
            storageBucket: "ledd-f6b0f.firebasestorage.app",
            messagingSenderId: "341802454320",
            appId: "1:341802454320:web:e0d13b16d14bc1ff5d8cf5"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = "masjid-banyuwangi-v2";

        let config = {
            lat: -8.2192,
            lng: 114.3691,
            fontSize: 20,
            clockColor: "#ffffff",
            ledMode: false,
            showSeconds: true,
            runningTextSpeed: 35,
            quranActive: true,
            bgOpacity: 0.3,
            videoOpacity: 0.3,
            fontFamily: 'Inter'
        };

        window.activateDisplay = () => {
            const elem = document.documentElement;
            if (elem.requestFullscreen) elem.requestFullscreen();
            document.body.style.cursor = 'none';
            document.getElementById('interaction-overlay').style.display = 'none';
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings'), (snap) => {
                    if (snap.exists()) {
                        config = { ...config, ...snap.data() };
                        applySettings();
                    }
                });
            } else {
                signInAnonymously(auth);
            }
        });

        function applySettings() {
            const clock = document.getElementById('main-clock');
            clock.style.fontSize = `${config.fontSize || 20}vw`;
            clock.style.color = config.clockColor || '#ffffff';
            clock.style.fontFamily = config.fontFamily || 'Inter';
            
            document.getElementById('seconds-wrap').classList.toggle('hidden', !config.showSeconds);
            document.getElementById('led-overlay').classList.toggle('hidden', !config.ledMode);
            
            const bgImg = document.getElementById('bg-image');
            bgImg.style.backgroundImage = config.bgUrl ? `url(${config.bgUrl})` : 'none';
            bgImg.style.opacity = config.bgOpacity ?? 0.3;

            const vLayer = document.getElementById('video-layer');
            if (config.ytId) {
                if (vLayer.getAttribute('data-id') !== config.ytId) {
                    vLayer.innerHTML = `<iframe class="w-full h-full scale-[1.5]" src="https://www.youtube.com/embed/${config.ytId}?autoplay=1&mute=1&loop=1&playlist=${config.ytId}&controls=0" frameborder="0"></iframe>`;
                    vLayer.setAttribute('data-id', config.ytId);
                }
                vLayer.style.opacity = config.videoOpacity ?? 0.3;
            } else {
                vLayer.innerHTML = "";
                vLayer.removeAttribute('data-id');
            }

            const marquee = document.getElementById('marquee-bar');
            if (config.quranActive) {
                marquee.classList.remove('hidden');
                const txt = document.getElementById('marquee-text');
                txt.innerText = config.runningText || "Mari rapatkan shaf dan luruskan barisan.";
                txt.style.setProperty('--speed', `${config.runningTextSpeed || 35}s`);
            } else {
                marquee.classList.add('hidden');
            }

            document.getElementById('alarm-overlay').classList.toggle('hidden', !config.alarmActive);
        }

        function refresh() {
            const now = moment().locale('id');
            document.getElementById('main-clock').innerText = now.format('HH:mm');
            document.getElementById('seconds-wrap').innerText = now.format('ss');
            document.getElementById('display-date').innerText = now.format('dddd, D MMMM YYYY');

            const coords = new adhan.Coordinates(config.lat || -8.2192, config.lng || 114.3691);
            const params = adhan.CalculationMethod.Kemenag();
            const pTimes = new adhan.PrayerTimes(coords, new Date(), params);

            const list = [
                { id: 'fajr', time: pTimes.fajr, label: 'Subuh' },
                { id: 'dhuhr', time: pTimes.dhuhr, label: 'Dzuhur' },
                { id: 'asr', time: pTimes.asr, label: 'Ashar' },
                { id: 'maghrib', time: pTimes.maghrib, label: 'Maghrib' },
                { id: 'isha', time: pTimes.isha, label: 'Isya' }
            ];

            let next = null;
            list.forEach(p => {
                const m = moment(p.time);
                document.getElementById(`time-${p.id}`).innerText = m.format('HH:mm');
                const box = document.getElementById(`box-${p.id}`);
                const isActive = now.isSameOrAfter(m) && now.isBefore(m.clone().add(20, 'minutes'));
                
                box.className = `prayer-card ${isActive ? 'active-prayer' : ''}`;
                if (!next && m.isAfter(now)) next = { name: p.label, time: m };
            });

            const countdownEl = document.getElementById('next-prayer-countdown');
            const labelEl = document.getElementById('label-menuju');
            
            if (next) {
                const dur = moment.duration(next.time.diff(now));
                labelEl.innerText = `Menuju ${next.name}`;
                countdownEl.innerText = `${String(dur.hours()).padStart(2,'0')}:${String(dur.minutes()).padStart(2,'0')}:${String(dur.seconds()).padStart(2,'0')}`;
            } else {
                labelEl.innerText = "Menuju Subuh";
                countdownEl.innerText = "--:--:--";
            }
        }

        setInterval(refresh, 1000);
        refresh();
    </script>
</body>
</html>

