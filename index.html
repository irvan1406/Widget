<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Masjid Proyektor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/locale/id.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/adhan@4.4.1/dist/Adhan.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@900&display=swap');
        body { background: #000; color: white; font-family: 'Inter', sans-serif; overflow: hidden; }
        .marquee { white-space: nowrap; animation: move var(--speed, 35s) linear infinite; font-size: 3rem; color: #ffcc00; font-weight: 900; }
        @keyframes move { from { transform: translateX(100vw); } to { transform: translateX(-100%); } }
    </style>
</head>
<body>
    <div id="interaction-overlay" onclick="this.remove()" class="fixed inset-0 bg-black z-[999] flex items-center justify-center cursor-pointer">
        <h1 class="text-3xl font-black animate-pulse">KLIK UNTUK FULLSCREEN</h1>
    </div>

    <div id="bg-img" class="fixed inset-0 opacity-30 bg-center bg-cover"></div>
    <div id="v-layer" class="fixed inset-0 opacity-30"></div>

    <div class="relative z-10 h-screen flex flex-col justify-between p-12 text-center">
        <div>
            <div id="date" class="text-3xl font-bold opacity-60 uppercase mb-4"></div>
            <div class="bg-green-600/20 border border-green-500/40 px-8 py-2 rounded-full inline-block text-2xl font-black">
                <span id="label-next">MENUNGGU...</span> <span id="countdown" class="ml-4 font-mono">00:00:00</span>
            </div>
        </div>

        <div id="clock" class="text-[25vw] leading-none font-black tracking-tighter">00:00</div>

        <div class="grid grid-cols-5 gap-6 mb-20">
            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <div class="opacity-50 font-bold mb-2 uppercase">Subuh</div>
                <div id="t-fajr" class="text-5xl font-black">--:--</div>
            </div>
            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <div class="opacity-50 font-bold mb-2 uppercase">Dzuhur</div>
                <div id="t-dhuhr" class="text-5xl font-black">--:--</div>
            </div>
            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <div class="opacity-50 font-bold mb-2 uppercase">Ashar</div>
                <div id="t-asr" class="text-5xl font-black">--:--</div>
            </div>
            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <div class="opacity-50 font-bold mb-2 uppercase">Maghrib</div>
                <div id="t-maghrib" class="text-5xl font-black">--:--</div>
            </div>
            <div class="bg-white/5 p-6 rounded-3xl border border-white/10">
                <div class="opacity-50 font-bold mb-2 uppercase">Isya</div>
                <div id="t-isha" class="text-5xl font-black">--:--</div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-0 w-full bg-black py-4 border-t border-white/10 overflow-hidden">
        <div id="m-text" class="marquee"></div>
    </div>

    <div id="alarm" class="fixed inset-0 bg-white text-black z-[1000] hidden flex flex-col items-center justify-center">
        <h1 class="text-[25vw] font-black italic">ADZAN</h1>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = JSON.parse('{"apiKey": "AIzaSyDiM9qD23njTQ6G8m8qzkUsNWRuQPd2SeY", "authDomain": "ledd-f6b0f.firebaseapp.com", "projectId": "ledd-f6b0f", "storageBucket": "ledd-f6b0f.firebasestorage.app", "messagingSenderId": "341802454320", "appId": "1:341802454320:web:e0d13b16d14bc1ff5d8cf5"}');
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'masjid-display-v1';
        let conf = { lat: -8.2192, lng: 114.3691, runningTextSpeed: 35 };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'settings'), (snap) => {
                    if (snap.exists()) {
                        conf = snap.data();
                        updateVisuals();
                    }
                });
            } else { signInAnonymously(auth); }
        });

        function updateVisuals() {
            document.getElementById('m-text').innerText = conf.runningText || "";
            document.getElementById('m-text').style.setProperty('--speed', `${conf.runningTextSpeed}s`);
            document.getElementById('bg-img').style.backgroundImage = conf.bgUrl ? `url(${conf.bgUrl})` : 'none';
            if (conf.ytId) {
                document.getElementById('v-layer').innerHTML = `<iframe class="w-full h-full scale-150" src="https://www.youtube.com/embed/${conf.ytId}?autoplay=1&mute=1&loop=1&playlist=${conf.ytId}&controls=0" frameborder="0"></iframe>`;
            }
            document.getElementById('alarm').classList.toggle('hidden', !conf.alarmActive);
        }

        function tick() {
            const now = moment().locale('id');
            document.getElementById('clock').innerText = now.format('HH:mm');
            document.getElementById('date').innerText = now.format('dddd, D MMMM YYYY');

            const coords = new adhan.Coordinates(conf.lat || -8.2192, conf.lng || 114.3691);
            const pTimes = new adhan.PrayerTimes(coords, new Date(), adhan.CalculationMethod.Kemenag());
            
            const list = [['fajr', pTimes.fajr, 'Subuh'], ['dhuhr', pTimes.dhuhr, 'Dzuhur'], ['asr', pTimes.asr, 'Ashar'], ['maghrib', pTimes.maghrib, 'Maghrib'], ['isha', pTimes.isha, 'Isya']];
            let next = null;
            list.forEach(([id, time, label]) => {
                const m = moment(time);
                document.getElementById(`t-${id}`).innerText = m.format('HH:mm');
                if (!next && m.isAfter(now)) next = { label, m };
            });

            if (next) {
                const dur = moment.duration(next.m.diff(now));
                document.getElementById('label-next').innerText = `MENUJU ${next.label.toUpperCase()}`;
                document.getElementById('countdown').innerText = `${String(dur.hours()).padStart(2,'0')}:${String(dur.minutes()).padStart(2,'0')}:${String(dur.seconds()).padStart(2,'0')}`;
            }
        }
        setInterval(tick, 1000);
    </script>
</body>
</html>

